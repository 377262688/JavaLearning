# TCP

## TCP 与 UDP

TCP（Transmission Control Protocol） 
UDP（User Datagram Protocol）

两者都是传输层协议。TCP 是面向有连接的可靠流服务，UDP面向无连接的可靠的服务。

这俩个普遍由操作系统实现，提供Socket API 接口供用户使用。

操作系统通过识别 IP 层的 源IP地址，目标IP地址，TCP首部的 协议类型（TCP/UDP），源端口号，目标端口号来确定
是否为同一个通信。

## TCP
TCP 是可以对"传输，发送，通信"进行"控制"的"协议"。
TCP 提供一系列的机制实现了可以在IP层这种无连接的网络上实现可靠的数据传输。
TCP 的连接是指，两个网络中的应用程序，为了相互传递消息而转有的虚拟的通信线路。应用程序就不需要考虑IP层的各种问题。
TCP 负责控制连接的建立，断开，保持等管理工作。

### 三次握手

客户端         服务器

 SYN  ------->            
               ACK
 ACK  ------->      

如果丢包，或者客户端没有收到回复数据，客户端会重发数据      
 
 ### 四次挥手
 
 客户端       服务器
 
 FIN ------->         
     <------- ACK
     <------- FIN
 ACK ------->
 ### 数据发送
 
 - 以段为单位发送数据，在建立连接时确认段的大小
 - 利用滑动窗口提高速度，窗口的单位为段，可以不用等待每一段都发送确认消息，直接继续发送一个段内的消息
 - 当收到该段内的确认消息时，直接将该消息偏移位置之前的数据直接丢弃，窗口滑动。
 - 滑动窗口还能进行重发控制，高速重发机制，当一个窗口内重复收到3次某一个段的数据丢失情况，则会触发重发机制，
 这种方式比超时重发更高效。
 - 流控制，在服务器回复的消息中，有个值为窗口大小，客户端就会发送不超过这个数据大小的数据给服务器，这个是由服务器
 缓冲区大小来确定返回的大小，这个值越大，网络吞吐量越高。
 - 拥塞控制，采用慢速启动的方式
 
 - 提高网络利用率
 
一 Negal 算法
 
此算法是指，发送端还有应该发送的数据，并且数据很小时，则可以进行延迟发送。只有当满足下列两个条件之一时，
才会立即发送数据：
1）已发送所有数据都收到确认应答时
2）可以发送最大段长度（MSS）数据时

此算法可以提高网络利用率，但是可能发送某种程度上的延迟

二 延迟确认应答

三 捎带应答

### TCP 包首部数据格式

每一行代表32位

源端口号（2字节） 目标端口号（2字节）
        序列号（4字节）
        确认应答号（4字节）
数据偏移 保留 控制位  窗口大小
校验和  紧急指针
选项  填充

